<!DOCTYPE html>  <html> <head>   <title>js2coffee.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               js2coffee.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>The JavaScript to CoffeeScript compiler.</p>

<p>Common usage:</p>

<pre><code>var src = "var square = function(n) { return n * n };"

js2coffee = require('js2coffee');
js2coffee.build(src);
//=&gt; "square = (n) -&gt; n * n"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Requires</h2>

<p>Js2coffee relies on Narcissus's parser. (Narcissus is Mozilla's JavaScript
engine written in JavaScript).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">{</span><span class="nx">parser</span><span class="p">}</span> <span class="o">=</span> <span class="err">@</span><span class="nx">Narcissus</span> <span class="o">or</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./narcissus_packed&#39;</span><span class="p">)</span>

<span class="nx">_</span> <span class="o">=</span> <span class="err">@</span><span class="nx">_</span> <span class="o">or</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">)</span>

<span class="p">{</span><span class="nx">Types</span><span class="p">,</span> <span class="nx">Typenames</span><span class="p">,</span> <span class="nx">Node</span><span class="p">}</span> <span class="o">=</span> <span class="err">@</span><span class="nx">NodeExt</span> <span class="o">or</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./node_ext&#39;</span><span class="p">)</span>

<span class="p">{</span><span class="nx">Code</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">strEscape</span><span class="p">,</span> <span class="nx">unreserve</span><span class="p">,</span> <span class="nx">unshift</span><span class="p">,</span> <span class="nx">isSingleLine</span><span class="p">,</span> <span class="nx">trim</span><span class="p">,</span> <span class="nx">blockTrim</span><span class="p">,</span>
  <span class="nx">ltrim</span><span class="p">,</span> <span class="nx">rtrim</span><span class="p">,</span> <span class="nx">strRepeat</span><span class="p">,</span> <span class="nx">paren</span><span class="p">,</span> <span class="nx">truthy</span><span class="p">,</span> <span class="nx">indentLines</span><span class="p">}</span> <span class="o">=</span> <span class="err">@</span><span class="nx">Js2coffeeHelpers</span> <span class="o">or</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./helpers&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Main entry point</h2>

<p>This is <code>require('js2coffee').build()</code>. It takes a JavaScript source
string as an argument, and it returns the CoffeeScript version.</p>

<ol>
<li><p>Ask Narcissus to break it down into Nodes (<code>parser.parse</code>). This
returns a <code>Node</code> object of type <code>script</code>.</p></li>
<li><p>This node is now passed onto <code>Builder#build()</code>.</p></li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">buildCoffee</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span>
  <span class="nx">str</span>  <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span> <span class="o">/</span><span class="err">\</span><span class="nx">r</span><span class="o">/</span><span class="nx">g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
  <span class="nx">str</span> <span class="o">+=</span> <span class="s2">&quot;\n&quot;</span>

  <span class="nx">builder</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">Builder</span> <span class="nx">opts</span>
  <span class="nx">scriptNode</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">str</span>

  <span class="nx">output</span> <span class="o">=</span> <span class="nx">trim</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">scriptNode</span><span class="p">)</span>

  <span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">no_comments</span>
    <span class="p">(</span><span class="nx">rtrim</span> <span class="nx">line</span> <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">output</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>

  <span class="k">else</span>
    <span class="nx">keepLineNumbers</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">show_src_lineno</span>

    <span class="nx">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">l</span> <span class="k">in</span> <span class="nx">output</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>

      <span class="nx">srclines</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="nx">text</span> <span class="o">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">replace</span> <span class="o">/</span><span class="err">\</span><span class="nx">uFEFE</span><span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">).</span><span class="o">*?</span><span class="err">\</span><span class="nx">uFEFE</span><span class="o">/</span><span class="nx">g</span><span class="p">,(</span><span class="nx">m</span><span class="p">,</span><span class="nx">g</span><span class="p">)</span> <span class="o">-&gt;</span>
          <span class="nx">srclines</span><span class="p">.</span><span class="nx">push</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span>
          <span class="s2">&quot;&quot;</span>

      <span class="nx">srclines</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">uniq</span><span class="p">(</span><span class="nx">srclines</span><span class="p">),</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">i</span><span class="p">)</span>

      <span class="nx">text</span> <span class="o">=</span> <span class="nx">rtrim</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
      <span class="nx">indent</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">match</span> <span class="o">/^</span><span class="err">\</span><span class="nx">s</span><span class="o">*</span><span class="err">/</span>

      <span class="k">if</span> <span class="nx">srclines</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">minline</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">last</span><span class="p">(</span><span class="nx">srclines</span><span class="p">)</span>

        <span class="nx">precomments</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">commentsNotDoneTo</span><span class="p">(</span><span class="nx">minline</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">precomments</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">push</span> <span class="nx">indentLines</span> <span class="nx">indent</span><span class="p">,</span><span class="nx">precomments</span>

      <span class="k">if</span> <span class="nx">text</span>
        <span class="k">if</span> <span class="nx">keepLineNumbers</span>
            <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span> <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span><span class="nx">srclines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;#  &quot;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">push</span> <span class="nx">rtrim</span><span class="p">(</span><span class="nx">text</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">ltrim</span><span class="p">(</span><span class="nx">builder</span><span class="p">.</span><span class="nx">lineComments</span><span class="p">(</span><span class="nx">srclines</span><span class="p">)))</span>
      <span class="k">else</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;&quot;</span>

    <span class="nx">comments</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">commentsNotDoneTo</span><span class="p">(</span><span class="mi">1</span><span class="nx">e10</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">comments</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">push</span> <span class="nx">comments</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Builder class</h2>

<p>This is the main class that proccesses the AST and spits out streng.
See the <code>buildCoffee()</code> function above for info on how this is used.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">class</span> <span class="nx">Builder</span>
  <span class="nv">constructor: </span><span class="p">(</span><span class="err">@</span><span class="nx">options</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">transformer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Transformer</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><code>l()</code> <br />
Inject the source line as a hidden element to be stripped out later.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">l: </span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>todo: this could be configurable debug helper
console.log n if n.lineno in [1]</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="err">@</span><span class="nx">options</span><span class="p">.</span><span class="nx">no_comments</span>
      <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nx">n</span> <span class="o">and</span> <span class="nx">n</span><span class="p">.</span><span class="nx">lineno</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>for DEBUG use this: "\uFEFE#{n.lineno},#{n.typeName()}\uFEFE"</p>             </td>             <td class="code">               <div class="highlight"><pre>       <span class="s2">&quot;\uFEFE#{n.lineno}\uFEFE&quot;</span>
    <span class="k">else</span>
      <span class="s2">&quot;&quot;</span>

  <span class="nv">makeComment: </span><span class="p">(</span><span class="nx">comment</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">type</span> <span class="o">is</span> <span class="s2">&quot;BLOCK_COMMENT&quot;</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>

      <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">and</span> <span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">and</span> <span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;*&quot;</span> <span class="c1"># docstring ?</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[\s\*]*/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">c</span> <span class="p">)</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\s]*$/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">c</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>remove empty lines</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">while</span> <span class="nx">c</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
        <span class="k">while</span> <span class="nx">c</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">c</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="s1">&#39;###&#39;</span><span class="p">)</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;###&#39;</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;##{line}&quot;</span> <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">c</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">comment</span><span class="p">.</span><span class="nx">value</span><span class="p">]</span>

    <span class="k">if</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">nlcount</span><span class="o">&gt;</span><span class="mi">0</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">unshift</span> <span class="s1">&#39;&#39;</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>

  <span class="nv">commentsNotDoneTo: </span><span class="p">(</span><span class="nx">lineno</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">loop</span>
      <span class="k">break</span> <span class="k">if</span> <span class="err">@</span><span class="nx">comments</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="err">@</span><span class="nx">comments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

      <span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">lineno</span> <span class="o">&lt;</span> <span class="nx">lineno</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="err">@</span><span class="nx">makeComment</span> <span class="nx">c</span><span class="p">)</span>
        <span class="err">@</span><span class="nx">comments</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
        <span class="k">continue</span>
      <span class="k">break</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>

  <span class="nv">lineComments: </span><span class="p">(</span><span class="nx">linenos</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>TODO: is there a nicer way to do this?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">selection</span> <span class="o">=</span> <span class="p">(</span><span class="nx">c</span> <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="err">@</span><span class="nx">comments</span> <span class="k">when</span> <span class="nx">c</span><span class="p">.</span><span class="nx">lineno</span> <span class="k">in</span> <span class="nx">linenos</span><span class="p">)</span>
    <span class="err">@</span><span class="nx">comments</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">difference</span><span class="p">(</span><span class="err">@</span><span class="nx">comments</span><span class="p">,</span> <span class="nx">selection</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="err">@</span><span class="nx">makeComment</span> <span class="nx">c</span> <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">selection</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><code>build()</code>
The main entry point.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>This finds the appropriate @builder function for <code>node</code> based on it's type,
the passes the node onto that function.</p>

<p>For instance, for a <code>function</code> node, it calls <code>@builders.function(node)</code>.
It defaults to <code>@builders.other</code> if it can't find a function for it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">build: </span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span> <span class="o">-&gt;</span>
    <span class="nx">node</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>get comments from tokenizer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="err">@</span><span class="nx">comments</span><span class="o">?</span>
      <span class="err">@</span><span class="nx">comments</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span> <span class="nx">node</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">comments</span><span class="p">,</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
        <span class="nx">n</span><span class="p">.</span><span class="nx">start</span>

    <span class="err">@</span><span class="nx">transform</span> <span class="nx">node</span>

    <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">node</span> <span class="o">!=</span> <span class="kc">undefined</span> <span class="o">and</span> <span class="nx">node</span><span class="p">.</span><span class="nx">typeName</span>

    <span class="nx">fn</span>  <span class="o">=</span> <span class="p">(</span><span class="err">@</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">or</span> <span class="err">@</span><span class="nx">other</span><span class="p">)</span>
    <span class="nx">out</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parenthesized</span> <span class="k">then</span> <span class="nx">paren</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span> <span class="k">else</span> <span class="nx">out</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><code>transform()</code>
Perform a transformation on the node, if a transformation function is
available.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">transform: </span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">transformer</span><span class="p">.</span><span class="nx">transform</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="nx">transformer</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><code>body()</code>
Works like <code>@build()</code>, and is used for code blocks. It cleans up the returned
code block by removing any extraneous spaces and such.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">body: </span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">opts</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="err">@</span><span class="nx">build</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="nx">blockTrim</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="nx">unshift</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">str</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>The builders</h2>

<p>Each of these method are passed a Node, and is expected to return
a string representation of it CoffeeScript counterpart.</p>

<p>These are invoked using the main entry point, <code>Builder#build()</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><code>script</code>
This is the main entry point.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;script&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">opts</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><em>Functions must always be declared first in a block.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">n</span><span class="p">.</span><span class="nx">functions</span><span class="p">,</span>    <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="err">@</span><span class="nx">build</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">n</span><span class="p">.</span><span class="nx">nonfunctions</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="err">@</span><span class="nx">build</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><code>property_identifier</code>
A key in an object literal.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;property_identifier&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>In object literals like <code>{ '#foo click': b }</code>, ensure that the key is
quoted if need be.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^([_\$a-z][_\$a-z0-9]*)$/i</span><span class="p">)</span> <span class="o">or</span> <span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[0-9]+$/i</span><span class="p">)</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">str</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">strEscape</span> <span class="nx">str</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><code>identifier</code>
Any object identifier like a variable name.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;identifier&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">value</span> <span class="o">is</span> <span class="s1">&#39;undefined&#39;</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;`undefined`&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">property_accessor</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">n</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">unreserve</span> <span class="nx">n</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

  <span class="s1">&#39;number&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{n.src()}&quot;</span>

  <span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">property_accessor</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">n</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">unreserve</span> <span class="nx">n</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><code>id_param</code>
Function parameters. Belongs to <code>list</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;id_param&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="k">in</span> <span class="p">[</span><span class="s1">&#39;undefined&#39;</span><span class="p">]</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{n}_&quot;</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="err">@</span><span class="nx">id</span> <span class="nx">n</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p><code>return</code>
A return statement. Has <code>n.value</code> of type <code>id</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;return&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">n</span><span class="p">.</span><span class="nx">value</span><span class="o">?</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;return\n&quot;</span>

    <span class="k">else</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;return #{@build(n.value)}\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><code>;</code> (aka, statement)
A single statement.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;;&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p><strong>Caveat:</strong>
Some statements can be blank as some people are silly enough to use <code>;;</code>
sometimes. They should be ignored.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unless</span> <span class="nx">n</span><span class="p">.</span><span class="nx">expression</span><span class="o">?</span>
      <span class="s2">&quot;&quot;</span>

    <span class="k">else</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">expression</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;object_init&#39;</span>

      <span class="nx">src</span> <span class="o">=</span> <span class="err">@</span><span class="nx">object_init</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">expression</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">parenthesized</span>
        <span class="nx">src</span>
      <span class="k">else</span>
        <span class="s2">&quot;#{unshift(blockTrim(src))}\n&quot;</span>

    <span class="k">else</span>
      <span class="err">@</span><span class="nx">build</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">expression</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><code>new</code> + <code>new_with_args</code> <br />
For <code>new X</code> and <code>new X(y)</code> respctively.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;new&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;new #{@build n.left()}&quot;</span>
  <span class="s1">&#39;new_with_args&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;new #{@build n.left()}(#{@build n.right()})&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h3>Unary operators</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;unary_plus&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;+#{@build n.left()}&quot;</span>
  <span class="s1">&#39;unary_minus&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;-#{@build n.left()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h3>Keywords</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;this&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;this&#39;</span>
  <span class="s1">&#39;null&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;null&#39;</span>
  <span class="s1">&#39;true&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;true&#39;</span>
  <span class="s1">&#39;false&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;false&#39;</span>
  <span class="s1">&#39;void&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;undefined&#39;</span>

  <span class="s1">&#39;debugger&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;debugger\n&quot;</span>
  <span class="s1">&#39;break&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;break\n&quot;</span>
  <span class="s1">&#39;continue&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;continue\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h3>Some simple operators</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;~&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="s2">&quot;~#{@build n.left()}&quot;</span>

  <span class="s1">&#39;typeof&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;typeof #{@build n.left()}&quot;</span>

  <span class="s1">&#39;index&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">right</span> <span class="o">=</span> <span class="err">@</span><span class="nx">build</span> <span class="nx">n</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">any</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">child</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">child</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;object_init&#39;</span> <span class="o">and</span> <span class="nx">child</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
      <span class="nx">right</span> <span class="o">=</span> <span class="s2">&quot;{#{right}}&quot;</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{@build n.left()}[#{right}]&quot;</span>

  <span class="s1">&#39;throw&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;throw #{@build n.exception}&quot;</span>

  <span class="s1">&#39;!&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">target</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nx">negations</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="o">++</span><span class="nx">negations</span> <span class="k">while</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">isA</span> <span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">and</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">negations</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">and</span> <span class="nx">target</span><span class="p">.</span><span class="nx">isA</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;===&#39;</span><span class="p">,</span> <span class="s1">&#39;!==&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;instanceof&#39;</span> <span class="c1"># invertible binary operators</span>
      <span class="nx">target</span><span class="p">.</span><span class="nx">negated</span> <span class="o">=</span> <span class="o">not</span> <span class="nx">target</span><span class="p">.</span><span class="nx">negated</span>
      <span class="k">return</span> <span class="err">@</span><span class="nx">build</span> <span class="nx">target</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{if negations &amp; 1 then &#39;not &#39; else &#39;!!&#39;}#{@build target}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h3>Binary operators</h3>

<p>All of these are rerouted to the <code>binary_operator</code> @builder.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>TODO: make a function that generates these functions, invoked like so:
  in: binop 'in', 'of'
  '+': binop '+'
  and so on...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">in</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>    <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;of&#39;</span>
  <span class="s1">&#39;+&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span>
  <span class="s1">&#39;-&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span>
  <span class="s1">&#39;*&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span>
  <span class="s1">&#39;/&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span>
  <span class="s1">&#39;%&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span>
  <span class="s1">&#39;&gt;&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span>
  <span class="s1">&#39;&lt;&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span>
  <span class="s1">&#39;&amp;&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span>
  <span class="s1">&#39;|&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span>
  <span class="s1">&#39;^&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span>
  <span class="s1">&#39;&amp;&amp;&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span>
  <span class="s1">&#39;||&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span>
  <span class="s1">&#39;&lt;&lt;&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;&lt;&lt;&#39;</span>
  <span class="s1">&#39;&lt;=&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span>
  <span class="s1">&#39;&gt;&gt;&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span>
  <span class="s1">&#39;&gt;=&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span>
  <span class="s1">&#39;===&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span>
  <span class="s1">&#39;!==&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;isnt&#39;</span>
  <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&gt;&#39;</span>
  <span class="k">instanceof</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;instanceof&#39;</span>

  <span class="s1">&#39;==&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>TODO: throw warning</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span>

  <span class="s1">&#39;!=&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>TODO: throw warning</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="err">@</span><span class="nx">binary_operator</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;isnt&#39;</span>

  <span class="s1">&#39;binary_operator&#39;</span><span class="o">:</span> <span class="nx">do</span> <span class="o">-&gt;</span>
    <span class="nx">INVERSIONS</span> <span class="o">=</span>
      <span class="o">is:</span> <span class="s1">&#39;isnt&#39;</span>
      <span class="k">in</span><span class="o">:</span> <span class="s1">&#39;not in&#39;</span>
      <span class="k">of</span><span class="o">:</span> <span class="s1">&#39;not of&#39;</span>
      <span class="k">instanceof</span><span class="o">:</span> <span class="s1">&#39;not instanceof&#39;</span>
    <span class="nx">INVERSIONS</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">k</span> <span class="k">for</span> <span class="nx">own</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">INVERSIONS</span>
    <span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">sign</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">sign</span> <span class="o">=</span> <span class="nx">INVERSIONS</span><span class="p">[</span><span class="nx">sign</span><span class="p">]</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">negated</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{@build n.left()} #{sign} #{@build n.right()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h3>Increments and decrements</h3>

<p>For <code>a++</code> and <code>--b</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;--&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">increment_decrement</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span>
  <span class="s1">&#39;++&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">increment_decrement</span> <span class="nx">n</span><span class="p">,</span> <span class="s1">&#39;++&#39;</span>

  <span class="s1">&#39;increment_decrement&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">sign</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">postfix</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{@build n.left()}#{sign}&quot;</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{sign}#{@build n.left()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p><code>=</code> (aka, assignment)
For <code>a = b</code> (but not <code>var a = b</code>: that's <code>var</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;=&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">sign</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">assignOp</span><span class="o">?</span>
      <span class="nx">Types</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">assignOp</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span>
    <span class="k">else</span>
      <span class="s1">&#39;=&#39;</span>

    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{@build n.left()} #{sign} #{@build n.right()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p><code>,</code> (aka, comma)
For `a = 1, b = 2'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;,&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span><span class="o">+</span><span class="err">@</span><span class="nx">build</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p><code>regexp</code> <br />
Regular expressions.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;regexp&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">m</span>     <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\/(.*)\/([a-z]?)/</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nx">flag</span>  <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>If it begins with <code>=</code> or a space, the CoffeeScript parser will choke if
it's written as <code>/=/</code>. Hence, they are written as <code>new RegExp('=')</code>.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">begins_with</span> <span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="nx">begins_with</span> <span class="k">in</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">flag</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;RegExp(#{strEscape value}, \&quot;#{flag}\&quot;)&quot;</span>
      <span class="k">else</span>
        <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;RegExp(#{strEscape value})&quot;</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/#{value}/#{flag}&quot;</span>

  <span class="s1">&#39;string&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span> <span class="nx">strEscape</span> <span class="nx">n</span><span class="p">.</span><span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p><code>call</code> <br />
A Function call.
<code>n.left</code> is an <code>id</code>, and <code>n.right</code> is a <code>list</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;call&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">right</span><span class="p">().</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="s2">&quot;#{@build n.left()}()&quot;</span><span class="o">+</span><span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="s2">&quot;#{@build n.left()}(#{@build n.right()})&quot;</span><span class="o">+</span><span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p><code>call_statement</code> <br />
A <code>call</code> that's on it's own line.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;call_statement&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">left</span> <span class="o">=</span> <span class="err">@</span><span class="nx">build</span> <span class="nx">n</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>When calling in this way: <code>function () { ... }()</code>,
ensure that there are parenthesis around the anon function
(eg, <code>(-&gt; ...)()</code>).</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">left</span> <span class="o">=</span> <span class="nx">paren</span><span class="p">(</span><span class="nx">left</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">left</span><span class="p">().</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">right</span><span class="p">().</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="s2">&quot;#{left}()&quot;</span><span class="o">+</span><span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="s2">&quot;#{left} #{@build n.right()}&quot;</span><span class="o">+</span><span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p><code>list</code>
A parameter list.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;list&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">is_list_element</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="err">@</span><span class="nx">build</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span>

    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">list</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>

  <span class="s1">&#39;delete&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">ids</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">build</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span>
    <span class="nx">ids</span> <span class="o">=</span> <span class="nx">ids</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;delete #{ids}\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p><code>.</code> (scope resolution?)
For instances such as <code>object.value</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;.&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>If called as <code>this.xxx</code>, it should use the at sign (<code>n.xxx</code>).</em></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>If called as <code>x.prototype</code>, it should use double colons (<code>x::</code>).</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">left</span>  <span class="o">=</span> <span class="err">@</span><span class="nx">build</span> <span class="nx">n</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nx">right_obj</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
    <span class="nx">right_obj</span><span class="p">.</span><span class="nx">property_accessor</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">right</span> <span class="o">=</span> <span class="err">@</span><span class="nx">build</span> <span class="nx">right_obj</span>

    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">isThis</span> <span class="o">and</span> <span class="nx">n</span><span class="p">.</span><span class="nx">isPrototype</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;@::&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">isThis</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;@#{right}&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">isPrototype</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{left}::&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">left</span><span class="p">().</span><span class="nx">isPrototype</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{left}#{right}&quot;</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{left}.#{right}&quot;</span>

  <span class="s1">&#39;try&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s1">&#39;try&#39;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">tryBlock</span><span class="p">)</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">n</span><span class="p">.</span><span class="nx">catchClauses</span><span class="p">,</span> <span class="p">(</span><span class="nx">clause</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="err">@</span><span class="nx">build</span><span class="p">(</span><span class="nx">clause</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">finallyBlock</span><span class="o">?</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;finally&quot;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">finallyBlock</span><span class="p">)</span>

    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span>

  <span class="s1">&#39;catch&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">body_</span> <span class="o">=</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">block</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="nx">trim</span><span class="p">(</span><span class="nx">body_</span><span class="p">).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">varName</span><span class="o">?</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;catch #{n.varName}&quot;</span>
    <span class="k">else</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s1">&#39;catch&#39;</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">block</span><span class="p">)</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p><code>?</code> (ternary operator) <br />
For <code>a ? b : c</code>. Note that these will always be parenthesized, as (I
believe) the order of operations in JS is different in CS.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;?&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;(if #{@build n.left()} then #{@build n.children[1]} else #{@build n.children[2]})&quot;</span>

  <span class="s1">&#39;for&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">setup</span><span class="o">?</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;#{@build n.setup}\n&quot;</span>

    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">condition</span><span class="o">?</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;while #{@build n.condition}\n&quot;</span>
    <span class="k">else</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;loop&quot;</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">update</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">update</span><span class="o">?</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span>

  <span class="s1">&#39;for_in&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;for #{@build n.iterator} of #{@build n.object}&quot;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span>

  <span class="s1">&#39;while&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">keyword</span>   <span class="o">=</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">positive</span> <span class="k">then</span> <span class="s2">&quot;while&quot;</span> <span class="k">else</span> <span class="s2">&quot;until&quot;</span>
    <span class="nx">body_</span>     <span class="o">=</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p><em>Use <code>loop</code> whin something will go on forever (like <code>while (true)</code>).</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">truthy</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">condition</span><span class="p">)</span>
      <span class="nx">statement</span> <span class="o">=</span> <span class="s2">&quot;loop&quot;</span>
    <span class="k">else</span>
      <span class="nx">statement</span> <span class="o">=</span> <span class="s2">&quot;#{keyword} #{@build n.condition}&quot;</span>

    <span class="k">if</span> <span class="nx">isSingleLine</span><span class="p">(</span><span class="nx">body_</span><span class="p">)</span> <span class="o">and</span> <span class="nx">statement</span> <span class="o">isnt</span> <span class="s2">&quot;loop&quot;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;#{trim body_}  #{statement}\n&quot;</span>
    <span class="k">else</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="nx">statement</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body_</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span>

  <span class="s1">&#39;do&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;loop&quot;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="s2">&quot;break unless #{@build n.condition}&quot;</span>  <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">condition</span><span class="o">?</span>

    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span>

  <span class="s1">&#39;if&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">keyword</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">positive</span> <span class="k">then</span> <span class="s2">&quot;if&quot;</span> <span class="k">else</span> <span class="s2">&quot;unless&quot;</span>
    <span class="nx">body_</span>   <span class="o">=</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">thenPart</span><span class="p">)</span>
    <span class="nx">n</span><span class="p">.</span><span class="nx">condition</span><span class="p">.</span><span class="nx">parenthesized</span> <span class="o">=</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p><em>Account for <code>if (xyz) {}</code>, which should be <code>xyz</code>. (#78)</em>
<em>Note that <code>!xyz</code> still compiles to <code>xyz</code> because the <code>!</code> will not change anything.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">thenPart</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">)</span> <span class="o">and</span> <span class="nx">n</span><span class="p">.</span><span class="nx">thenPart</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">and</span> <span class="o">!</span><span class="nx">n</span><span class="p">.</span><span class="nx">elsePart</span><span class="o">?</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">n</span><span class="p">.</span><span class="nx">thenPart</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;#{@build n.condition}\n&quot;</span>

    <span class="k">else</span> <span class="k">if</span> <span class="nx">isSingleLine</span><span class="p">(</span><span class="nx">body_</span><span class="p">)</span> <span class="o">and</span> <span class="o">!</span><span class="nx">n</span><span class="p">.</span><span class="nx">elsePart</span><span class="o">?</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;#{trim body_}  #{keyword} #{@build n.condition}\n&quot;</span>

    <span class="k">else</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;#{keyword} #{@build n.condition}&quot;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">thenPart</span><span class="p">)</span>

      <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">elsePart</span><span class="o">?</span>
        <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">elsePart</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;if&#39;</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;else #{@build(n.elsePart).toString()}&quot;</span>
        <span class="k">else</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">elsePart</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;else\n&quot;</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">elsePart</span><span class="p">)</span>

    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span>

  <span class="s1">&#39;switch&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;switch #{@build n.discriminant}\n&quot;</span>

    <span class="nx">fall_through</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">n</span><span class="p">.</span><span class="nx">cases</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;else&quot;</span>
      <span class="k">else</span>
        <span class="k">if</span> <span class="nx">fall_through</span> <span class="o">==</span> <span class="kc">true</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, #{@build item.caseLabel}\n&quot;</span>
        <span class="k">else</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;  when #{@build item.caseLabel}&quot;</span>

      <span class="k">if</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">statements</span><span class="p">).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="nx">fall_through</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="k">else</span>
        <span class="nx">fall_through</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;\n&quot;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">statements</span><span class="p">),</span> <span class="mi">2</span>

      <span class="nx">first</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span>

  <span class="s1">&#39;existence_check&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#{@build n.left()}?&quot;</span>

  <span class="s1">&#39;array_init&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;[]&quot;</span>
    <span class="k">else</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;[#{@list n}]&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p><code>property_init</code> <br />
Belongs to <code>object_init</code>;
left is a <code>identifier</code>, right can be anything.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;property_init&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">left</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
    <span class="nx">right</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">right</span><span class="p">()</span>
    <span class="nx">right</span><span class="p">.</span><span class="nx">is_property_value</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="s2">&quot;#{@property_identifier left}: #{@build right}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p><code>object_init</code> <br />
An object initializer.
Has many <code>property_init</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;object_init&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">options</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;{}&quot;</span>

    <span class="k">else</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">and</span> <span class="o">not</span> <span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">is_property_value</span> <span class="o">or</span> <span class="nx">n</span><span class="p">.</span><span class="nx">is_list_element</span><span class="p">)</span>
      <span class="err">@</span><span class="nx">build</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">else</span>
      <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="err">@</span><span class="nx">build</span> <span class="nx">item</span>

      <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span> <span class="err">@</span><span class="p">,</span> <span class="nx">n</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">list</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="s2">&quot;{#{c}}&quot;</span>  <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">brackets</span><span class="o">?</span>
      <span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p><code>function</code> <br />
A function. Can be an anonymous function (<code>function () { .. }</code>), or a named
function (<code>function name() { .. }</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;function&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">params</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">n</span><span class="p">.</span><span class="nx">params</span><span class="p">,</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">String</span>
        <span class="err">@</span><span class="nx">id_param</span> <span class="nx">str</span>
      <span class="k">else</span>
        <span class="err">@</span><span class="nx">build</span> <span class="nx">str</span>

    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">name</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;#{n.name} = &quot;</span>

    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;(#{params.join &#39;, &#39;}) -&gt;&quot;</span>
    <span class="k">else</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;-&gt;&quot;</span>

    <span class="nx">body</span> <span class="o">=</span> <span class="err">@</span><span class="nx">body</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">trim</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span>
    <span class="k">else</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;\n&quot;</span>

    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span>

  <span class="s1">&#39;var&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="s2">&quot;#{unreserve item.value} = #{if item.initializer? then @build(item.initializer) else &#39;undefined&#39;}&quot;</span>

    <span class="err">@</span><span class="nx">l</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">_</span><span class="p">.</span><span class="nx">compact</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <h3>Unsupported things</h3>

<p>Due to CoffeeScript limitations, the following things are not supported:</p>

<ul>
<li>New getter/setter syntax (<code>x.prototype = { get name() { ... } };</code>)</li>
<li>Break labels (<code>my_label: ...</code>)</li>
<li>Constants</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;other&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">unsupported</span> <span class="nx">n</span><span class="p">,</span> <span class="s2">&quot;#{n.typeName()} is not supported yet&quot;</span>
  <span class="s1">&#39;getter&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="err">@</span><span class="nx">unsupported</span> <span class="nx">n</span><span class="p">,</span> <span class="s2">&quot;getter syntax is not supported; use __defineGetter__&quot;</span>
  <span class="s1">&#39;setter&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>  <span class="err">@</span><span class="nx">unsupported</span> <span class="nx">n</span><span class="p">,</span> <span class="s2">&quot;setter syntax is not supported; use __defineSetter__&quot;</span>
  <span class="s1">&#39;label&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">unsupported</span> <span class="nx">n</span><span class="p">,</span> <span class="s2">&quot;labels are not supported by CoffeeScript&quot;</span>
  <span class="s1">&#39;const&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>   <span class="err">@</span><span class="nx">unsupported</span> <span class="nx">n</span><span class="p">,</span> <span class="s2">&quot;consts are not supported by CoffeeScript&quot;</span>

  <span class="s1">&#39;block&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">args</span><span class="p">...)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">script</span><span class="p">.</span><span class="nx">apply</span> <span class="err">@</span><span class="p">,</span> <span class="nx">args</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p><code>unsupported()</code> <br />
Throws an unsupported error.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;unsupported&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnsupportedError</span><span class="p">(</span><span class="s2">&quot;Unsupported: #{message}&quot;</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <h2>AST manipulation</h2>

<p>Manipulation of the abstract syntax tree happens here. All these are done on
the <code>build()</code> step, done just before a node is passed onto <code>Builders</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">class</span> <span class="nx">Transformer</span>
  <span class="nv">transform: </span><span class="p">(</span><span class="nx">args</span><span class="p">...)</span> <span class="o">-&gt;</span>
    <span class="nx">node</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span>  <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">transformed</span><span class="o">?</span>
    <span class="nx">type</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span>
    <span class="nx">fn</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span>

    <span class="k">if</span> <span class="nx">fn</span>
      <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">transformed</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="s1">&#39;script&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">n</span><span class="p">.</span><span class="nx">functions</span>    <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">n</span><span class="p">.</span><span class="nx">nonfunctions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">)</span>
        <span class="nx">n</span><span class="p">.</span><span class="nx">functions</span><span class="p">.</span><span class="nx">push</span> <span class="nx">item</span>
      <span class="k">else</span>
        <span class="nx">n</span><span class="p">.</span><span class="nx">nonfunctions</span><span class="p">.</span><span class="nx">push</span> <span class="nx">item</span>

    <span class="nx">last</span> <span class="o">=</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p><em>Statements don't need parens, unless they are consecutive object
literals.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">n</span><span class="p">.</span><span class="nx">nonfunctions</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">expression</span><span class="o">?</span>
        <span class="nx">expr</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">expression</span>

        <span class="k">if</span> <span class="nx">last</span><span class="o">?</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;object_init&#39;</span><span class="p">)</span> <span class="o">and</span> <span class="nx">expr</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;object_init&#39;</span><span class="p">)</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">parenthesized</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">else</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">parenthesized</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="nx">last</span> <span class="o">=</span> <span class="nx">expr</span>

  <span class="s1">&#39;.&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">n</span><span class="p">.</span><span class="nx">isThis</span>      <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">left</span><span class="p">().</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;this&#39;</span><span class="p">)</span>
    <span class="nx">n</span><span class="p">.</span><span class="nx">isPrototype</span> <span class="o">=</span> <span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">right</span><span class="p">().</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;identifier&#39;</span><span class="p">)</span> <span class="o">and</span> <span class="nx">n</span><span class="p">.</span><span class="nx">right</span><span class="p">().</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;prototype&#39;</span><span class="p">)</span>

  <span class="s1">&#39;;&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">expression</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p><em>Statements don't need parens.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">n</span><span class="p">.</span><span class="nx">expression</span><span class="p">.</span><span class="nx">parenthesized</span> <span class="o">=</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p><em>If the statement only has one function call (eg, <code>alert(2);</code>), the
parentheses should be omitted (eg, <code>alert 2</code>).</em></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">expression</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;call&#39;</span><span class="p">)</span>
        <span class="nx">n</span><span class="p">.</span><span class="nx">expression</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">Typenames</span><span class="p">[</span><span class="s1">&#39;call_statement&#39;</span><span class="p">]</span>
        <span class="err">@</span><span class="nx">call_statement</span> <span class="nx">n</span>

  <span class="s1">&#39;function&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p><em>Unwrap the <code>return</code>s.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">n</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">walk</span> <span class="nv">last: </span><span class="kc">true</span><span class="p">,</span> <span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">)</span> <span class="o">and</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Hax</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">lastNode</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">list</span>
          <span class="nx">parent</span><span class="p">[</span><span class="nx">list</span><span class="p">]</span>
        <span class="k">else</span>
          <span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nx">lastNode</span>
          <span class="nx">lastNode</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">Typenames</span><span class="p">[</span><span class="s1">&#39;;&#39;</span><span class="p">]</span>
          <span class="nx">lastNode</span><span class="p">.</span><span class="nx">expression</span> <span class="o">=</span> <span class="nx">lastNode</span><span class="p">.</span><span class="nx">value</span>

  <span class="s1">&#39;switch&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">n</span><span class="p">.</span><span class="nx">cases</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">block</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">statements</span>
      <span class="nx">ch</span>    <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">children</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p><em>CoffeeScript does not need <code>break</code> statements on <code>switch</code> blocks.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">delete</span> <span class="nx">ch</span><span class="p">[</span><span class="nx">ch</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nx">block</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span><span class="o">?</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;break&#39;</span><span class="p">)</span>

  <span class="s1">&#39;call_statement&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
        <span class="k">if</span> <span class="nx">child</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="o">and</span> <span class="nx">i</span> <span class="o">!=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span>
          <span class="nx">child</span><span class="p">.</span><span class="nx">parenthesized</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="s1">&#39;return&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p><em>Doing "return {x:2, y:3}" should parenthesize the return value.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">value</span> <span class="o">and</span> <span class="nx">n</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;object_init&#39;</span><span class="p">)</span> <span class="o">and</span> <span class="nx">n</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">parenthesized</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="s1">&#39;block&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">script</span> <span class="nx">n</span>

  <span class="s1">&#39;if&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p><em>Account for <code>if(x) {} else { something }</code> which should be <code>something unless x</code>.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">thenPart</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">and</span> <span class="nx">n</span><span class="p">.</span><span class="nx">elsePart</span><span class="o">?</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">positive</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">thenPart</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">elsePart</span>
      <span class="k">delete</span> <span class="nx">n</span><span class="p">.</span><span class="nx">elsePart</span>

    <span class="err">@</span><span class="nx">inversible</span> <span class="nx">n</span>

  <span class="s1">&#39;while&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p><em>A while with a blank body (<code>while(x){}</code>) should be accounted for.</em>
<em>You can't have empty blocks, so put a <code>continue</code> in there. (#78)</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">push</span> <span class="nx">n</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nv">type: </span><span class="nx">Typenames</span><span class="p">[</span><span class="s1">&#39;continue&#39;</span><span class="p">],</span> <span class="nv">value: </span><span class="s1">&#39;continue&#39;</span><span class="p">,</span> <span class="nv">children: </span><span class="p">[])</span>

    <span class="err">@</span><span class="nx">inversible</span> <span class="nx">n</span>

  <span class="s1">&#39;inversible&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">transform</span> <span class="nx">n</span><span class="p">.</span><span class="nx">condition</span>
    <span class="nx">positive</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">positive</span><span class="o">?</span> <span class="k">then</span> <span class="nx">n</span><span class="p">.</span><span class="nx">positive</span> <span class="k">else</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p><em>Invert a '!='. (<code>if (x != y)</code> => <code>unless x is y</code>)</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">condition</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;!=&#39;</span><span class="p">)</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">condition</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">Typenames</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">]</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">positive</span> <span class="o">=</span> <span class="o">not</span> <span class="nx">positive</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p><em>Invert a '!'. (<code>if (!x)</code> => <code>unless x</code>)</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">condition</span><span class="p">.</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">condition</span> <span class="o">=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">condition</span><span class="p">.</span><span class="nx">left</span><span class="p">()</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">positive</span> <span class="o">=</span> <span class="o">not</span> <span class="nx">positive</span>

    <span class="k">else</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">positive</span> <span class="o">=</span> <span class="nx">positive</span>

  <span class="s1">&#39;==&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">right</span><span class="p">().</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="s1">&#39;void&#39;</span><span class="p">)</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">type</span>     <span class="o">=</span> <span class="nx">Typenames</span><span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">]</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nv">type: </span><span class="nx">Typenames</span><span class="p">[</span><span class="s1">&#39;existence_check&#39;</span><span class="p">],</span> <span class="nv">children: </span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">left</span><span class="p">()])]</span>

  <span class="s1">&#39;!=&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">right</span><span class="p">().</span><span class="nx">isA</span><span class="p">(</span><span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="s1">&#39;void&#39;</span><span class="p">)</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">type</span>     <span class="o">=</span> <span class="nx">Typenames</span><span class="p">[</span><span class="s1">&#39;existence_check&#39;</span><span class="p">]</span>
      <span class="nx">n</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">left</span><span class="p">()]</span>

<span class="nx">class</span> <span class="nx">UnsupportedError</span>
  <span class="nv">constructor: </span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">src</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">str</span>
    <span class="err">@</span><span class="nx">cursor</span>  <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">start</span>
    <span class="err">@</span><span class="nx">line</span>    <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">lineno</span>
    <span class="err">@</span><span class="nx">source</span>  <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">source</span>

  <span class="nv">toString: </span><span class="o">-&gt;</span> <span class="err">@</span><span class="nx">message</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <h2>Exports</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="err">@</span><span class="nx">Js2coffee</span> <span class="o">=</span> <span class="nx">exports</span> <span class="o">=</span>
  <span class="nv">VERSION: </span><span class="s1">&#39;0.2.0&#39;</span>
  <span class="nv">build: </span><span class="nx">buildCoffee</span>
  <span class="nv">UnsupportedError: </span><span class="nx">UnsupportedError</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">exports</span>  <span class="k">if</span> <span class="nx">module</span><span class="o">?</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 