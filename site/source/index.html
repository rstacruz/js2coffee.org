<!DOCTYPE html>  <html> <head>   <title>js2coffee.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               js2coffee.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>The JavaScript to CoffeeScript compiler.
Common usage:</p>

<pre><code>var src = "var square = function(n) { return n * n };"

js2coffee = require('js2coffee');
js2coffee.build(src);
//=&gt; "square = (n) -&gt; n * n"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Requires</h2>

<p>Js2coffee relies on Narcissus's parser. (Narcissus is Mozilla's JavaScript
engine written in JavaScript).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="nb">window</span><span class="o">?</span>
  <span class="nx">narcissus</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Narcissus</span>
  <span class="nx">_</span>         <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">_</span>
<span class="k">else</span>
  <span class="nx">narcissus</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./narcissus_packed&#39;</span><span class="p">)</span>
  <span class="nx">_</span>         <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">)</span>

<span class="nx">tokens</span> <span class="o">=</span> <span class="nx">narcissus</span><span class="p">.</span><span class="nx">definitions</span><span class="p">.</span><span class="nx">tokens</span>
<span class="nx">parser</span> <span class="o">=</span> <span class="nx">narcissus</span><span class="p">.</span><span class="nx">parser</span>
<span class="nx">Node</span>   <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">Node</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Main entry point</h2>

<p>This is <code>require('js2coffee').build()</code>. It takes a JavaScript source
string as an argument, and it returns the CoffeeScript version.</p>

<ol>
<li><p>Ask Narcissus to break it down into Nodes (<code>parser.parse</code>). This
returns a <code>Node</code> object of type <code>script</code>.</p></li>
<li><p>This node is now passed onto <code>build()</code>.</p></li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">buildCoffee</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">scriptNode</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;#{str}\n&quot;</span><span class="p">)</span>

  <span class="nx">trim</span> <span class="nx">build</span><span class="p">(</span><span class="nx">scriptNode</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Narcissus node helpers</h2>

<p>Some extensions to the Node class to make things easier later on.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><code>left() / right()</code> <br />
These are aliases for the first and last child.
Often helpful for things like binary operators.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">left</span>  <span class="o">=</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">right</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p><code>unsupported()</code> <br />
Throws an unsupported error.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unsupported</span> <span class="o">=</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnsupportedError</span><span class="p">(</span><span class="s2">&quot;Unsupported: #{msg}&quot;</span><span class="p">,</span> <span class="err">@</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><code>typeName()</code> <br />
Returns the typename in lowercase. (eg, 'function')</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Node</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">typeName</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="nx">Types</span><span class="p">[</span><span class="err">@</span><span class="nx">type</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>Main functions</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p><code>build()</code> <br />
This finds the appropriate builder function for <code>node</code> based on it's type,
the passes the node onto that function.</p>

<p>For instance, for a <code>function</code> node, it calls <code>Builders.function(node)</code>.
It defaults to <code>Builders.other</code> if it can't find a function for it.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">build</span> <span class="o">=</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">opts</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">node</span> <span class="o">!=</span> <span class="kc">undefined</span> <span class="o">and</span> <span class="nx">node</span><span class="p">.</span><span class="nx">typeName</span>

  <span class="nx">out</span> <span class="o">=</span> <span class="p">(</span><span class="nx">Builders</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">or</span> <span class="nx">Builders</span><span class="p">.</span><span class="nx">other</span><span class="p">).</span><span class="nx">apply</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="p">[</span><span class="nx">opts</span><span class="p">])</span>

  <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">parenthesized</span><span class="o">?</span> <span class="k">then</span> <span class="nx">paren</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span> <span class="k">else</span> <span class="nx">out</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><code>re()</code> <br />
Works like <code>build()</code>, except it explicitly states which function should
handle it. (essentially, <em>re</em>routing it to another builder)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">re</span> <span class="o">=</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">args</span><span class="p">...)</span> <span class="o">-&gt;</span>
  <span class="nx">Builders</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">apply</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">args</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><code>body()</code>
Works like <code>build()</code>, and is used for code blocks. It cleans up the returned
code block by removing any extraneous spaces and such.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">body</span> <span class="o">=</span> <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">opts</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="nx">build</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="nx">blockTrim</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="nx">unshift</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>

  <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">str</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h2>Types</h2>

<p>The <code>Types</code> global object contains a map of Narcissus type numbers to type
names. It probably looks like:</p>

<pre><code>Types = { ...
  '42': 'script',
  '43': 'block',
  '44': 'label',
  '45': 'for_in',
  ...
}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Types</span> <span class="o">=</span> <span class="p">(</span><span class="o">-&gt;</span>
  <span class="nx">dict</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">for</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">tokens</span>
    <span class="nx">dict</span><span class="p">[</span><span class="nx">tokens</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">i</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">tokens</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;number&#39;</span>

  <span class="nx">dict</span>
<span class="p">)()</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>The builders</h2>

<p>Each of these functions are apply'd to a Node, and is expected to return
a string representation of it CoffeeScript counterpart.</p>

<p>These are invoked using <code>build()</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Builders</span> <span class="o">=</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><code>script</code> <br />
This is the main entry point.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;script&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">opts</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">len</span> <span class="o">=</span> <span class="err">@</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span>

    <span class="k">if</span> <span class="nx">len</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><em>Omit returns if not needed.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">returnable</span><span class="o">?</span>
        <span class="err">@</span><span class="nx">children</span><span class="p">[</span><span class="nx">len</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">last</span> <span class="o">=</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><em>CoffeeScript does not need <code>break</code> statements on <code>switch</code> blocks.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">noBreak</span><span class="o">?</span> <span class="o">and</span> <span class="err">@</span><span class="nx">children</span><span class="p">[</span><span class="nx">len</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;break&#39;</span>
        <span class="k">delete</span> <span class="err">@</span><span class="nx">children</span><span class="p">[</span><span class="nx">len</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><em>Functions must always be declared first in a block.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="err">@</span><span class="nx">children</span><span class="o">?</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="err">@</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">-&gt;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="nx">build</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="err">@</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">-&gt;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="nx">build</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;function&#39;</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><code>property_identifier</code> <br />
A key in an object literal.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;property_identifier&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="err">@</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>In object literals like <code>{ '#foo click': b }</code>, ensure that the key is
quoted if need be.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^([_\$a-z][_\$a-z0-9]*)$/i</span><span class="p">)</span> <span class="o">or</span> <span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[0-9]+$/i</span><span class="p">)</span>
      <span class="nx">str</span>
    <span class="k">else</span>
      <span class="nx">strEscape</span> <span class="nx">str</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><code>identifier</code> <br />
Any object identifier like a variable name.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;identifier&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">unreserve</span> <span class="err">@</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>

  <span class="s1">&#39;number&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="s2">&quot;#{@value}&quot;</span>

  <span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">unreserve</span> <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><code>id_param</code> <br />
Function parameters. Belongs to <code>list</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;id_param&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">toString</span><span class="p">()</span> <span class="k">in</span> <span class="p">[</span><span class="s1">&#39;undefined&#39;</span><span class="p">]</span>
      <span class="s2">&quot;#{@}_&quot;</span>
    <span class="k">else</span>
      <span class="nx">re</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p><code>return</code> <br />
A return statement. Has <code>@value</code> of type <code>id</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;return&#39;</span><span class="o">:</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><strong>Caveat 1:</strong>
<em>Empty returns need to always be <code>return</code>, regardless if it's the last
statement in the block or not.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="err">@</span><span class="nx">value</span><span class="o">?</span>
      <span class="s2">&quot;return&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p><strong>Caveat 2:</strong>
<em>If it's the last statement in the block, we can omit the 'return' keyword.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="err">@</span><span class="nx">last</span><span class="o">?</span>
      <span class="nx">build</span><span class="p">(</span><span class="err">@</span><span class="nx">value</span><span class="p">)</span>

    <span class="k">else</span>
      <span class="s2">&quot;return #{build(@value)}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><code>;</code> (aka, statement) <br />
A single statement.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;;&#39;</span><span class="o">:</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p><strong>Caveat:</strong>
Some statements can be blank as some people are silly enough to use <code>;;</code>
sometimes. They should be ignored.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="err">@</span><span class="nx">expression</span><span class="o">?</span>
      <span class="s2">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p><strong>Caveat 2:</strong>
<em>If the statement only has one function call (eg, <code>alert(2);</code>), the
parentheses should be omitted (eg, <code>alert 2</code>).</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="err">@</span><span class="nx">expression</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;call&#39;</span>
      <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;call_statement&#39;</span><span class="p">,</span> <span class="err">@</span><span class="nx">expression</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span>

    <span class="k">else</span> <span class="k">if</span> <span class="err">@</span><span class="nx">expression</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;object_init&#39;</span>
      <span class="nx">paren</span><span class="p">(</span><span class="nx">re</span><span class="p">(</span><span class="s1">&#39;object_init&#39;</span><span class="p">,</span> <span class="err">@</span><span class="nx">expression</span><span class="p">,</span> <span class="nv">brackets: </span><span class="kc">true</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span>

    <span class="k">else</span>
      <span class="nx">build</span><span class="p">(</span><span class="err">@</span><span class="nx">expression</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p><code>new</code> + <code>new_with_args</code> <br />
For <code>new X</code> and <code>new X(y)</code> respctively.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;new&#39;</span><span class="o">:</span>           <span class="o">-&gt;</span> <span class="s2">&quot;new #{build @left()}&quot;</span>
  <span class="s1">&#39;new_with_args&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="s2">&quot;new #{build @left()}(#{build @right()})&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h3>Unary operators</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;unary_plus&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="s2">&quot;+#{build @left()}&quot;</span>
  <span class="s1">&#39;unary_minus&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="s2">&quot;-#{build @left()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h3>Keywords</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;this&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="s1">&#39;this&#39;</span>
  <span class="s1">&#39;null&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="s1">&#39;null&#39;</span>
  <span class="s1">&#39;true&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="s1">&#39;true&#39;</span>
  <span class="s1">&#39;false&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="s1">&#39;false&#39;</span>
  <span class="s1">&#39;void&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="s1">&#39;undefined&#39;</span>

  <span class="s1">&#39;debugger&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="s2">&quot;debugger\n&quot;</span>
  <span class="s1">&#39;break&#39;</span><span class="o">:</span>    <span class="o">-&gt;</span> <span class="s2">&quot;break\n&quot;</span>
  <span class="s1">&#39;continue&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="s2">&quot;continue\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h3>Some simple operators</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;!&#39;</span><span class="o">:</span>      <span class="o">-&gt;</span> <span class="s2">&quot;not #{build @left()}&quot;</span>
  <span class="s1">&#39;~&#39;</span><span class="o">:</span>      <span class="o">-&gt;</span> <span class="s2">&quot;~#{build @left()}&quot;</span>
  <span class="s1">&#39;typeof&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="s2">&quot;typeof #{build @left()}&quot;</span>
  <span class="s1">&#39;index&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="s2">&quot;#{build @left()}[#{build @right()}]&quot;</span>
  <span class="s1">&#39;throw&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="s2">&quot;throw #{build @exception}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <h3>Binary operators</h3>

<p>All of these are rerouted to the <code>binary_operator</code> builder.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;+&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
  <span class="s1">&#39;-&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
  <span class="s1">&#39;*&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
  <span class="s1">&#39;/&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
  <span class="s1">&#39;%&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>
  <span class="s1">&#39;&gt;&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
  <span class="s1">&#39;&lt;&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">)</span>
  <span class="s1">&#39;&amp;&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
  <span class="s1">&#39;|&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">)</span>
  <span class="s1">&#39;^&#39;</span><span class="o">:</span>   <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">)</span>
  <span class="s1">&#39;&amp;&amp;&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">)</span>
  <span class="s1">&#39;||&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">)</span>
  <span class="s1">&#39;in&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span>
  <span class="s1">&#39;==&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">)</span>
  <span class="s1">&#39;&lt;&lt;&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;&lt;&lt;&#39;</span><span class="p">)</span>
  <span class="s1">&#39;&lt;=&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">)</span>
  <span class="s1">&#39;&gt;&gt;&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">)</span>
  <span class="s1">&#39;&gt;=&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">)</span>
  <span class="s1">&#39;!=&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">)</span>
  <span class="s1">&#39;===&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">)</span>
  <span class="s1">&#39;!==&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;isnt&#39;</span><span class="p">)</span>

  <span class="s1">&#39;instanceof&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;binary_operator&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;instanceof&#39;</span><span class="p">)</span>

  <span class="s1">&#39;binary_operator&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">sign</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="s2">&quot;#{build @left()} #{sign} #{build @right()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h3>Increments and decrements</h3>

<p>For <code>a++</code> and <code>--b</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;--&#39;</span><span class="o">:</span>     <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;increment_decrement&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
  <span class="s1">&#39;++&#39;</span><span class="o">:</span>     <span class="o">-&gt;</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;increment_decrement&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">,</span> <span class="s1">&#39;++&#39;</span><span class="p">)</span>

  <span class="s1">&#39;increment_decrement&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">sign</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">postfix</span>
      <span class="s2">&quot;#{build @left()}#{sign}&quot;</span>
    <span class="k">else</span>
      <span class="s2">&quot;#{sign}#{build @left()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p><code>=</code> (aka, assignment) <br />
For <code>a = b</code> (but not <code>var a = b</code>: that's <code>var</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;=&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">sign</span> <span class="o">=</span> <span class="k">if</span> <span class="err">@</span><span class="nx">assignOp</span><span class="o">?</span>
      <span class="nx">Types</span><span class="p">[</span><span class="err">@</span><span class="nx">assignOp</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span>
    <span class="k">else</span>
      <span class="s1">&#39;=&#39;</span>

    <span class="s2">&quot;#{build @left()} #{sign} #{build @right()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p><code>,</code> (aka, comma) <br />
For `a = 1, b = 2'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;,&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="err">@</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">build</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p><code>regexp</code> <br />
Regular expressions.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;regexp&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">m</span>     <span class="o">=</span> <span class="err">@</span><span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\/(.*)\/([a-z]?)/</span><span class="p">)</span>
    <span class="nx">value</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nx">flag</span>  <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>If it begins with <code>=</code> or a space, the CoffeeScript parser will choke if
it's written as <code>/=/</code>. Hence, they are written as <code>new RegExp('=')</code>.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">begins_with</span> <span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="nx">begins_with</span> <span class="k">in</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="nx">flag</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="s2">&quot;RegExp(#{strEscape value}, \&quot;#{flag}\&quot;)&quot;</span>
      <span class="k">else</span>
        <span class="s2">&quot;RegExp(#{strEscape value})&quot;</span>
    <span class="k">else</span>
      <span class="s2">&quot;/#{value}/#{flag}&quot;</span>

  <span class="s1">&#39;string&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">strEscape</span> <span class="err">@</span><span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p><code>call</code> <br />
A Function call.
<code>@left</code> is an <code>id</code>, and <code>@right</code> is a <code>list</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;call&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">right</span><span class="p">().</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="s2">&quot;#{build @left()}()&quot;</span>
    <span class="k">else</span>
      <span class="s2">&quot;#{build @left()}(#{build @right()})&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p><code>call_statement</code> <br />
A <code>call</code> that's on it's own line.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;call_statement&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">left</span> <span class="o">=</span> <span class="nx">build</span> <span class="err">@</span><span class="nx">left</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>When calling in this way: <code>function () { ... }()</code>,
ensure that there are parenthesis around the anon function
(eg, <code>(-&gt; ...)()</code>).</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">left</span> <span class="o">=</span> <span class="nx">paren</span><span class="p">(</span><span class="nx">left</span><span class="p">)</span>  <span class="k">if</span> <span class="err">@</span><span class="nx">left</span><span class="p">().</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span>

    <span class="k">if</span> <span class="err">@</span><span class="nx">right</span><span class="p">().</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="s2">&quot;#{left}()&quot;</span>
    <span class="k">else</span>
      <span class="s2">&quot;#{left} #{build @right()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p><code>list</code> <br />
A parameter list.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;list&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="err">@</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">build</span><span class="p">(</span><span class="nx">item</span><span class="p">))</span>

    <span class="nx">list</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>

  <span class="s1">&#39;delete&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">ids</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="err">@</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">build</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span>
    <span class="nx">ids</span> <span class="o">=</span> <span class="nx">ids</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
    <span class="s2">&quot;delete #{ids}\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p><code>.</code> (scope resolution?) <br />
For instances such as <code>object.value</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;.&#39;</span><span class="o">:</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>If called as <code>this.xxx</code>, it should use the at sign (<code>@xxx</code>).</em></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p><strong>Caveat:</strong>
<em>If called as <code>x.prototype</code>, it should use double colons (<code>x::</code>).</em></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">isThis</span> <span class="o">=</span> <span class="p">(</span><span class="err">@</span><span class="nx">left</span><span class="p">().</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;this&#39;</span><span class="p">)</span>
    <span class="nx">isPrototype</span> <span class="o">=</span> <span class="p">(</span><span class="err">@</span><span class="nx">right</span><span class="p">().</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;identifier&#39;</span> <span class="o">and</span> <span class="err">@</span><span class="nx">right</span><span class="p">().</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;prototype&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">isThis</span> <span class="o">and</span> <span class="nx">isPrototype</span>
      <span class="s2">&quot;@::&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">isThis</span>
      <span class="s2">&quot;@#{build @right()}&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">isPrototype</span>
      <span class="s2">&quot;#{build @left()}::&quot;</span>
    <span class="k">else</span>
      <span class="s2">&quot;#{build @left()}.#{build @right()}&quot;</span>

  <span class="s1">&#39;try&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s1">&#39;try&#39;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">tryBlock</span><span class="p">)</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="err">@</span><span class="nx">catchClauses</span><span class="p">,</span> <span class="p">(</span><span class="nx">clause</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="nx">build</span><span class="p">(</span><span class="nx">clause</span><span class="p">)</span>

    <span class="k">if</span> <span class="err">@</span><span class="nx">finallyBlock</span><span class="o">?</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;finally&quot;</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">finallyBlock</span><span class="p">)</span>

    <span class="nx">c</span>

  <span class="s1">&#39;catch&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">varName</span><span class="o">?</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;catch #{@varName}&quot;</span>
    <span class="k">else</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s1">&#39;catch&#39;</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">block</span><span class="p">)</span>
    <span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p><code>?</code> (ternary operator) <br />
For <code>a ? b : c</code>. Note that these will always be parenthesized, as (I
believe) the order of operations in JS is different in CS.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;?&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="s2">&quot;(if #{build @left()} then #{build @children[1]} else #{build @children[2]})&quot;</span>

  <span class="s1">&#39;for&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="k">if</span> <span class="err">@</span><span class="nx">setup</span><span class="o">?</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;#{build @setup}\n&quot;</span>

    <span class="k">if</span> <span class="err">@</span><span class="nx">condition</span><span class="o">?</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;while #{build @condition}\n&quot;</span>
    <span class="k">else</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;while true&quot;</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">body</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">update</span><span class="p">)</span>  <span class="k">if</span> <span class="err">@</span><span class="nx">update</span><span class="o">?</span>
    <span class="nx">c</span>

  <span class="s1">&#39;for_in&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;for #{build @iterator} of #{build @object}&quot;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">body</span><span class="p">)</span>
    <span class="nx">c</span>

  <span class="s1">&#39;while&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;while #{build @condition}&quot;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">body</span><span class="p">)</span>
    <span class="nx">c</span>

  <span class="s1">&#39;do&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;while true&quot;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">body</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="s2">&quot;break unless #{build @condition}&quot;</span>  <span class="k">if</span> <span class="err">@</span><span class="nx">condition</span><span class="o">?</span>

    <span class="nx">c</span>

  <span class="s1">&#39;if&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;if #{build @condition}&quot;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">thenPart</span><span class="p">)</span>

    <span class="k">if</span> <span class="err">@</span><span class="nx">elsePart</span><span class="o">?</span>
      <span class="k">if</span> <span class="err">@</span><span class="nx">elsePart</span><span class="p">.</span><span class="nx">typeName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;if&#39;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;else #{build(@elsePart).toString()}&quot;</span>
      <span class="k">else</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;else\n&quot;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">elsePart</span><span class="p">)</span>

    <span class="nx">c</span>

  <span class="s1">&#39;switch&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;switch #{build @discriminant}\n&quot;</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="err">@</span><span class="nx">cases</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">-&gt;</span>

      <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="s2">&quot;else&quot;</span>
      <span class="k">else</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="s2">&quot;when #{build item.caseLabel}\n&quot;</span>

      <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">statements</span><span class="p">,</span> <span class="nv">noBreak: </span><span class="kc">true</span><span class="p">),</span> <span class="mi">2</span>

      <span class="nx">first</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="nx">c</span>

  <span class="s1">&#39;array_init&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="s2">&quot;[]&quot;</span>
    <span class="k">else</span>
      <span class="nx">list</span> <span class="o">=</span> <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="err">@</span><span class="p">)</span>
      <span class="s2">&quot;[ #{list} ]&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p><code>property_init</code> <br />
Belongs to <code>object_init</code>;
left is a <code>identifier</code>, right can be anything.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;property_init&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="s2">&quot;#{re &#39;property_identifier&#39;, @left()}: #{build @right()}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p><code>object_init</code> <br />
An object initializer.
Has many <code>property_init</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;object_init&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">options</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="s2">&quot;{}&quot;</span>

    <span class="k">else</span> <span class="k">if</span> <span class="err">@</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span>
      <span class="nx">build</span> <span class="err">@</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">else</span>
      <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="err">@</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">build</span> <span class="nx">item</span>

      <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">list</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="s2">&quot;{#{c}}&quot;</span>  <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">brackets</span><span class="o">?</span>
      <span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p><code>function</code> <br />
A function. Can be an anonymous function (<code>function () { .. }</code>), or a named
function (<code>function name() { .. }</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;function&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Code</span>

    <span class="nx">params</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="err">@</span><span class="nx">params</span><span class="p">,</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">String</span>
        <span class="nx">re</span><span class="p">(</span><span class="s1">&#39;id_param&#39;</span><span class="p">,</span> <span class="nx">str</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nx">build</span> <span class="nx">str</span>

    <span class="k">if</span> <span class="err">@</span><span class="nx">name</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;#{@name} = &quot;</span>

    <span class="k">if</span> <span class="err">@</span><span class="nx">params</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;(#{params.join &#39;, &#39;}) -&gt;&quot;</span>
    <span class="k">else</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">add</span> <span class="s2">&quot;-&gt;&quot;</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">scope</span> <span class="nx">body</span><span class="p">(</span><span class="err">@</span><span class="nx">body</span><span class="p">,</span> <span class="nv">returnable: </span><span class="kc">true</span><span class="p">)</span>
    <span class="nx">c</span>

  <span class="s1">&#39;var&#39;</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="err">@</span><span class="nx">children</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="s2">&quot;#{item.value} = #{build(item.initializer)}&quot;</span>  <span class="k">if</span> <span class="nx">item</span><span class="p">.</span><span class="nx">initializer</span><span class="o">?</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">compact</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <h3>Unsupported things</h3>

<p>Due to CoffeeScript limitations, the following things are not supported:</p>

<ul>
<li>New getter/setter syntax (<code>x.prototype = { get name() { ... } };</code>)</li>
<li>Break labels (<code>my_label: ...</code>)</li>
<li>Constants</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="s1">&#39;other&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">unsupported</span> <span class="s2">&quot;#{@typeName()} is not supported yet&quot;</span>
  <span class="s1">&#39;getter&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">unsupported</span> <span class="s2">&quot;getter syntax is not supported; use __defineGetter__&quot;</span>
  <span class="s1">&#39;setter&#39;</span><span class="o">:</span> <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">unsupported</span> <span class="s2">&quot;setter syntax is not supported; use __defineSetter__&quot;</span>
  <span class="s1">&#39;label&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">unsupported</span> <span class="s2">&quot;labels are not supported by CoffeeScript&quot;</span>
  <span class="s1">&#39;const&#39;</span><span class="o">:</span>  <span class="o">-&gt;</span> <span class="err">@</span><span class="nx">unsupported</span> <span class="s2">&quot;consts are not supported by CoffeeScript&quot;</span>

<span class="nx">Builders</span><span class="p">.</span><span class="nx">block</span> <span class="o">=</span> <span class="nx">Builders</span><span class="p">.</span><span class="nx">script</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <h2>Unsupported Error exception</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">class</span> <span class="nx">UnsupportedError</span>
  <span class="nv">constructor: </span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">src</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">str</span>
    <span class="err">@</span><span class="nx">cursor</span>  <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">start</span>
    <span class="err">@</span><span class="nx">line</span>    <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">lineno</span>
    <span class="err">@</span><span class="nx">source</span>  <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">source</span>

  <span class="nv">toString: </span><span class="o">-&gt;</span> <span class="err">@</span><span class="nx">message</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <h2>Code snippet helper</h2>

<p>A helper class to deal with building code.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">class</span> <span class="nx">Code</span>
  <span class="nv">constructor: </span><span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

  <span class="nv">add: </span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">code</span> <span class="o">+=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="err">@</span>

  <span class="nv">scope: </span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">indent</span> <span class="o">=</span> <span class="nx">strRepeat</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="nx">level</span><span class="p">)</span>
    <span class="err">@</span><span class="nx">code</span>  <span class="o">=</span> <span class="nx">rtrim</span><span class="p">(</span><span class="err">@</span><span class="nx">code</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span>
    <span class="err">@</span><span class="nx">code</span> <span class="o">+=</span> <span class="nx">indent</span> <span class="o">+</span> <span class="nx">rtrim</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span> <span class="s2">&quot;\n#{indent}&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span>
    <span class="err">@</span>

  <span class="nv">toString: </span><span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">code</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <h2>String helpers</h2>

<p>These are functions that deal with strings.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p><code>paren()</code> <br />
Wraps a given string in parentheses.
Examples:</p>

<pre><code>paren 'hi'   =&gt; "(hi)"
paren '(hi)' =&gt; "(hi)"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">paren</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span> <span class="o">and</span> <span class="nx">str</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;)&#39;</span>
    <span class="nx">str</span>
  <span class="k">else</span>
    <span class="s2">&quot;(#{str})&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p><code>strRepeat()</code> <br />
Repeats a string a certain number of times.
Example:</p>

<pre><code>strRepeat('.', 3) =&gt; "..."
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">strRepeat</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">times</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">(</span><span class="nx">str</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">times</span><span class="p">]).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p><code>trim()</code> <em>and friends</em> <br />
String trimming functions.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">ltrim</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="s2">&quot;#{str}&quot;</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s*/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="nx">rtrim</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="s2">&quot;#{str}&quot;</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s*$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="nx">blockTrim</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="s2">&quot;#{str}&quot;</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s*\n|\s*$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="nx">trim</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="s2">&quot;#{str}&quot;</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s*|\s*$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p><code>unshift()</code> <br />
Removes any unneccesary indentation from a code block string.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">unshift</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;#{str}&quot;</span>

  <span class="k">while</span> <span class="kc">true</span>
    <span class="nx">m1</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^/gm</span><span class="p">)</span>
    <span class="nx">m2</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^ /gm</span><span class="p">)</span>

    <span class="k">return</span> <span class="nx">str</span>  <span class="k">if</span> <span class="o">!</span><span class="nx">m1</span> <span class="o">or</span> <span class="o">!</span><span class="nx">m2</span> <span class="o">or</span> <span class="nx">m1</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">m2</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^ /gm</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p><code>strEscape()</code> <br />
Escapes a string.
Example:</p>

<ul>
<li><code>hello "there"</code> turns to <code>"hello \"there\""</code></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">strEscape</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="s2">&quot;#{str}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p><code>p()</code> <br />
Debugging tool. Prints an object to the console.
Not actually used, but here for convenience.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">p</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">str</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span>
    <span class="k">delete</span> <span class="nx">str</span><span class="p">.</span><span class="nx">tokenizer</span>  <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">tokenizer</span><span class="o">?</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">str</span>
  <span class="k">else</span> <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">String</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">str</span>
  <span class="s1">&#39;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p><code>unreserve()</code> <br />
Picks the next best thing for a reserved keyword.
Example:</p>

<pre><code>"in"    =&gt; "in_"
"hello" =&gt; "hello"
"off"   =&gt; "off"
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">unreserve</span> <span class="o">=</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="s2">&quot;#{str}&quot;</span> <span class="k">in</span> <span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;loop&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="s1">&#39;when&#39;</span><span class="p">,</span> <span class="s1">&#39;not&#39;</span><span class="p">,</span> <span class="s1">&#39;until&#39;</span><span class="p">,</span> <span class="s1">&#39;__bind&#39;</span><span class="p">,</span> <span class="s1">&#39;__indexOf&#39;</span><span class="p">]</span>
    <span class="s2">&quot;#{str}_&quot;</span>
  <span class="k">else</span>
    <span class="s2">&quot;#{str}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <h2>Exports</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">exports</span> <span class="o">=</span>
  <span class="nv">version: </span><span class="s1">&#39;0.0.4&#39;</span>
  <span class="nv">build: </span><span class="nx">buildCoffee</span>
  <span class="nv">UnsupportedError: </span><span class="nx">UnsupportedError</span>

<span class="k">if</span> <span class="nb">window</span><span class="o">?</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">Js2coffee</span> <span class="o">=</span> <span class="nx">exports</span>

<span class="k">if</span> <span class="nx">module</span><span class="o">?</span>
  <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">exports</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 